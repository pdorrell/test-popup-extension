<!DOCTYPE html">
<html lang="en" >
<head><meta charset="utf-8">
<title>Test Page for Test Chrome Popup Extension</title>
<script type="text/javascript" src="extension/jquery-1.10.2.js"></script>
<script type="text/javascript" src="extension/initialise-target-tab.js"></script>
<link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body onload='if (window.location.search == "?load") createTitleEditorWindow();'>

<h1>Test Page for Test Chrome Popup Extension</h1>

<p><i>Philip Dorrell, 19 August, 2013</i></p>

<h2>test-popup-extension</h2>

<p><b><a href="https://github.com/pdorrell/test-popup-extension">test-popup-extension</a></b>
is a template for a Chrome browser extension where a popup windows acts on the contents
of the target tab.
</p>

<p>This test page lets you load the popup directly, i.e. without having to install (or reload) 
the Chrome extension.</p>

<h2>How to Run the Extension Popup Window</h2>

<p>There are three ways you can invoke the popup window to edit the title of this web page:</p>

<ul>
 <li>Click this button: <button onclick="createTitleEditorWindow();">Create Title Editor Window</button></li>
 <li>Load this page with the <b>load</b> query, i.e.
<a href="index.html?load"><b>index.html?load</b></a>.</li>
 <li>Load the page <a href="index_load.html"><b>index_load.html</b></a>, which
redirects to <b>index.html?load</b>. (This is a useful option when
the browser command line refuses to let you include characters like "?" in the URL argument.)</li>
</ul>

<p>

<h2>How to Install the Extension</h2>

<p><b>Chrome</b> makes it very easy to install an extension during development &ndash; you
go to the "Extensions" page in the browser (under the "Tools" menu), and tell it 
to "Load unpacked extension ...".</p>

<p>The <b>test-popup-extension</b> project has all the extension files in the <b>extension</b>
subdirectory, so that's the directory you load the unpacked extension from.</p>

<h2>How the Popup Window Performs Actions on the Target Tab</h2>

<p>What makes popup windows in Chrome extensions slightly difficult is that the Chrome
browser does <i>not</i> allow access to <b>window.opener</b>. Instead, all communication between
windows must be via <b>chrome.runtime.onMessage</b> and <b>chrome.tabs.sendMessage</b>.</p>

<p><b>test-popup-extension</b> deals with the differences between normal popup windows
and extension popup windows by defining functionality on the content tab in 
the form of an object which can be executed either "locally", or "remotely" via the Chrome 
extension messaging API.</p>

<p>For details of how this is done, see the source code. A brief summary is:</p>

<ul>
 <li>Define a target object representing actions to be performed on the content (target) tab
(in this case <b>TitledWindow</b>).</li>
 <li>Define all "public" methods on the target object with two parameters: a <b>request</b> object,
and a <b>result handler</b> (in this case, the <b>getPageDetails</b> and <b>setWindowTitle</b> methods). 
The request object wraps actual parameter values, and the result handler
is used to process the result of the method (i.e. instead of using <b>return</b>).</li>
 <li>In the popup window's Javascript, define a <b>proxy</b> for the target object which has
the same public method signatures, but which implements the methods by sending messages to the 
content tab (in this case <b>TitledWindowProxy</b>).</li>
 <li>In the content tab's Javascript, define a handler for messages, which passes them on to
the local target object, and then passes the results back to the result handler of the message handler.</li>
</ul>

</body>
</html>
